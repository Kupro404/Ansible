---
- hosts: all
  become: true
  vars:
     container_count: 1
     default_container_name: docker4
     default_container_image: debian
     default_container_command: sleep 1
     
  tasks:
   - name: Install aptitude
     apt:
       name: aptitude
       state: latest
       update_cache: true
 
   - name: Install required system packages
     apt:
       pkg:
         - apt-transport-https
         - ca-certificates
         - curl
         - software-properties-common
         - python3-pip
         - virtualenv
         - python3-setuptools
       state: latest
       update_cache: true

   - name: Add Docker GPG apt Key
     apt_key:
       url: https://download.docker.com/linux/debian/gpg
       state: present
 
   - name: Add Docker Repository 
     apt_repository:
       repo: deb https://download.docker.com/linux/debian stretch stable
       state: present
 
   - name: Add Docker Repository
     apt_repository:
       repo: deb https://download.docker.com/linux/debian bookworm stable
       state: present
 
   - name: Update apt and install docker-compose
     apt:
       name: docker-compose
       state: latest
       update_cache: true
 
   - name: Update apt and install docker
     apt:
       name: docker
       state: latest
       update_cache: true
 
   - name: install nftables
     apt:
       name: nftables
       state: latest
 
   - name: create composer dir
     command: " mkdir /root/wordpress-compose"
 
   - name: copy compose file
     ansible.builtin.copy:
       src: ./docker-compose.yaml
       dest: /root/wordpress-compose/docker-compose.yaml
 
    - name: run containers
      command: 'docker-compose up -d'
      args:
        chdir: '/root/wordpress-compose'
 
    - name: remove default nft conf file
      command: "rm /etc/nftables.conf"
 
    - name: copy nft file
      ansible.builtin.copy:
        src: ./nftables.conf
        dest: /etc/nftables.conf
 
    - name: load nft rules
      command: "/sbin/nft -f /etc/nftables.conf"










   
